<!DOCTYPE html>
<html data-wf-page="test-stripe" data-wf-site="66da12845dc932214d8bd04d">

<head>
    <meta charset="utf-8" />
    <title>Stripe Test - Gen X Shred</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Webflow" name="generator" />
    <link href="css/webflow-style.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">
        WebFont.load({
            google: {
                families: ["Bebas Neue:regular", "Barlow:100,200,300,regular,500,600,700,800,900"]
            }
        });
    </script>
    <link href="images/favicon-32.png" rel="shortcut icon" type="image/x-icon" />
    <link href="images/app-icon.png" rel="apple-touch-icon" />
    <style>
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -o-font-smoothing: antialiased;
        }
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background: #111;
            border-radius: 10px;
            color: white;
        }
        .test-card {
            background: #222;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #333;
        }
        .test-button {
            background: #4d65ff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            margin: 10px 5px;
            min-width: 200px;
        }
        .test-button:hover {
            background: #3d55ef;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .debug-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 15px 0;
            border-left: 4px solid #4d65ff;
        }
        .status-message {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .test-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .test-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="page-wrapper">
        <main class="main-wrapper">
            <div class="test-container">
                <h1 style="color: #4d65ff; text-align: center; margin-bottom: 10px;">üß™ Stripe Integration Test</h1>
                <p style="text-align: center; margin-bottom: 30px; color: #ccc;">Test your trial membership and Netlify Functions</p>

                <!-- Trial Membership Test -->
                <div class="test-card">
                    <h2 style="color: #ffd700; margin-bottom: 15px;">üéØ Trial Membership Test</h2>
                    <div class="debug-info">
                        <strong>Price ID:</strong> price_1RmegGGOLHhy7CIrRYJfK4sg<br>
                        <strong>Function URL:</strong> /.netlify/functions/create-checkout-session<br>
                        <strong>Current Domain:</strong> <span id="currentDomain"></span>
                    </div>
                    <p>Click the button below to test your trial membership subscription with Stripe:</p>
                    <button id="testTrialBtn" class="test-button">Test Trial Membership</button>
                    <div id="trialStatus" class="status-message"></div>
                </div>

                <!-- Existing Plans Test -->
                <div class="test-card">
                    <h2 style="color: #ffd700; margin-bottom: 15px;">üíº Existing Plans Test</h2>
                    <p>Test your existing coaching plans:</p>
                    <div class="test-cards">
                        <div>
                            <h4 style="color: #4d65ff;">Monthly Plan ($149)</h4>
                            <button id="testMonthlyBtn" class="test-button">Test Monthly Plan</button>
                        </div>
                        <div>
                            <h4 style="color: #4d65ff;">Weekly Plan ($189)</h4>
                            <button id="testWeeklyBtn" class="test-button">Test Weekly Plan</button>
                        </div>
                    </div>
                    <div id="plansStatus" class="status-message"></div>
                </div>

                <!-- Function Status Check -->
                <div class="test-card">
                    <h2 style="color: #ffd700; margin-bottom: 15px;">üîß Function Status</h2>
                    <p>Check if your Netlify Function is properly deployed:</p>
                    <button id="checkFunctionBtn" class="test-button">Check Function Status</button>
                    <div id="functionStatus" class="status-message"></div>
                </div>

                <!-- Test Cards Information -->
                <div class="test-card">
                    <h2 style="color: #ffd700; margin-bottom: 15px;">üí≥ Test Card Numbers</h2>
                    <div class="debug-info">
                        <strong>‚úÖ Success:</strong> 4242 4242 4242 4242<br>
                        <strong>‚ùå Decline:</strong> 4000 0000 0000 0002<br>
                        <strong>üîê 3D Secure:</strong> 4000 0025 0000 3155<br>
                        <strong>üìÖ Expiry:</strong> Any future date (e.g., 12/28)<br>
                        <strong>üîí CVC:</strong> Any 3 digits (e.g., 123)
                    </div>
                </div>

                <!-- Console Logs -->
                <div class="test-card">
                    <h2 style="color: #ffd700; margin-bottom: 15px;">üìä Debug Console</h2>
                    <p>Open your browser's developer console (F12) to see detailed logs during testing.</p>
                    <div id="consoleOutput" class="debug-info" style="max-height: 200px; overflow-y: auto;">
                        Console output will appear here...
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Stripe Configuration -->
    <script>
        // Test Configuration
        const TEST_STRIPE_CONFIG = {
            publishableKey: 'pk_live_51RZlAAGOLHhy7CIraslBhtePtrTJX8e4KSzjjJHXwtfvuJ9g7sRe43ydGPhcq3cvdr8QwlrXy17AWD4IqrFVLE8A00UJsBvbM9',
            priceIds: {
                trial: 'price_1RmegGGOLHhy7CIrRYJfK4sg',  // Trial membership
                monthly: 'price_1RmQJhGOLHhy7CIrBCyjShQV', // $149/month plan
                weekly: 'price_1RmQL8GOLHhy7CIrM9Pxj86W'    // $189/month plan
            }
        };

        // Initialize Stripe
        const stripe = Stripe(TEST_STRIPE_CONFIG.publishableKey);

        // Display current domain
        document.getElementById('currentDomain').textContent = window.location.origin;

        // Console logging helper
        function logToConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage);
            
            const consoleOutput = document.getElementById('consoleOutput');
            consoleOutput.innerHTML += `<div style="color: ${type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc'}">${logMessage}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // Generic function to test checkout
        async function testCheckout(priceId, planName, statusElementId) {
            const statusElement = document.getElementById(statusElementId);
            const button = event.target;
            
            // Reset status
            statusElement.style.display = 'none';
            button.disabled = true;
            button.textContent = 'Processing...';
            
            logToConsole(`Testing ${planName} with price ID: ${priceId}`);

            try {
                const response = await fetch('/.netlify/functions/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        priceId: priceId,
                        planName: planName
                    })
                });

                logToConsole(`Response status: ${response.status}`);
                logToConsole(`Response URL: ${response.url}`);

                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = await response.json();
                    } catch (e) {
                        errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
                    }
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const session = await response.json();
                logToConsole('‚úÖ Session created successfully!', 'success');
                logToConsole(`Session ID: ${session.sessionId}`);

                statusElement.className = 'status-message success';
                statusElement.innerHTML = `
                    <strong>‚úÖ Success!</strong> Checkout session created!<br>
                    <small>Session ID: ${session.sessionId}</small><br>
                    <small>Redirecting to Stripe...</small>
                `;
                statusElement.style.display = 'block';

                // Redirect to Stripe Checkout
                setTimeout(async () => {
                    const result = await stripe.redirectToCheckout({
                        sessionId: session.sessionId
                    });

                    if (result.error) {
                        throw new Error(result.error.message);
                    }
                }, 2000);

            } catch (error) {
                logToConsole(`‚ùå Error: ${error.message}`, 'error');
                
                statusElement.className = 'status-message error';
                if (error.message.includes('404')) {
                    statusElement.innerHTML = `
                        <strong>‚ùå Function Not Found!</strong><br>
                        Your Netlify Function isn't deployed or accessible.<br>
                        <small>Make sure you've deployed to Netlify and set STRIPE_SECRET_KEY environment variable.</small>
                    `;
                } else if (error.message.includes('Failed to fetch')) {
                    statusElement.innerHTML = `
                        <strong>‚ùå Network Error!</strong><br>
                        ${error.message}<br>
                        <small>Are you testing locally? Netlify Functions only work when deployed.</small>
                    `;
                } else {
                    statusElement.innerHTML = `
                        <strong>‚ùå Error:</strong> ${error.message}
                    `;
                }
                statusElement.style.display = 'block';
            } finally {
                button.disabled = false;
                button.textContent = button.id.includes('trial') ? 'Test Trial Membership' : 
                                   button.id.includes('monthly') ? 'Test Monthly Plan' :
                                   button.id.includes('weekly') ? 'Test Weekly Plan' : 'Test';
            }
        }

        // Function status check
        async function checkFunctionStatus() {
            const statusElement = document.getElementById('functionStatus');
            const button = document.getElementById('checkFunctionBtn');
            
            statusElement.style.display = 'none';
            button.disabled = true;
            button.textContent = 'Checking...';
            
            logToConsole('Checking function status...');

            try {
                const response = await fetch('/.netlify/functions/create-checkout-session', {
                    method: 'OPTIONS'
                });

                logToConsole(`Function response status: ${response.status}`);

                if (response.status === 200) {
                    statusElement.className = 'status-message success';
                    statusElement.innerHTML = `
                        <strong>‚úÖ Function is Live!</strong><br>
                        Your Netlify Function is properly deployed and responding.
                    `;
                } else {
                    statusElement.className = 'status-message error';
                    statusElement.innerHTML = `
                        <strong>‚ö†Ô∏è Function Status: ${response.status}</strong><br>
                        Function exists but may have issues.
                    `;
                }
                statusElement.style.display = 'block';

            } catch (error) {
                logToConsole(`‚ùå Function check error: ${error.message}`, 'error');
                
                statusElement.className = 'status-message error';
                statusElement.innerHTML = `
                    <strong>‚ùå Function Not Accessible!</strong><br>
                    ${error.message}<br>
                    <small>Make sure your site is deployed to Netlify with functions enabled.</small>
                `;
                statusElement.style.display = 'block';
            } finally {
                button.disabled = false;
                button.textContent = 'Check Function Status';
            }
        }

        // Event listeners
        document.getElementById('testTrialBtn').addEventListener('click', () => {
            testCheckout(TEST_STRIPE_CONFIG.priceIds.trial, 'Trial Membership', 'trialStatus');
        });

        document.getElementById('testMonthlyBtn').addEventListener('click', () => {
            testCheckout(TEST_STRIPE_CONFIG.priceIds.monthly, 'Monthly Coaching Plan', 'plansStatus');
        });

        document.getElementById('testWeeklyBtn').addEventListener('click', () => {
            testCheckout(TEST_STRIPE_CONFIG.priceIds.weekly, 'Weekly Coaching Plan', 'plansStatus');
        });

        document.getElementById('checkFunctionBtn').addEventListener('click', checkFunctionStatus);

        // Initial log
        logToConsole('üß™ Stripe Test Page Loaded', 'success');
        logToConsole(`Testing environment: ${window.location.origin}`);
    </script>
</body>

</html>
